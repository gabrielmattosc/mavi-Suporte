{% extends "base.html" %}

{% block title %}Resultados da Pesquisa para "{{ query }}"{% endblock %}

{% block content %}
<div class="container fade-in">
    <header>
        <h1><i class="fas fa-history"></i> Histórico de Tickets para "{{ query }}"</h1>
        <p class="subtitle">
            Página {{ pagination.page }} de {{ pagination.pages }}. Total de {{ pagination.total }} tickets encontrados.
        </p>
    </header>

    <div class="card">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID do Ticket</th>
                        <th>Status</th>
                        <th>Prioridade</th>
                        <th>Data de Criação</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Loop através dos itens da página atual -->
                    {% for ticket in pagination.items %}
                    <tr>
                        <td><strong>#{{ ticket.ticket_id }}</strong></td>
                        <td>
                            <span class="status-badge status-{{ ticket.status.lower().replace(' ', '-').replace('ã', 'a') }}">
                                {{ ticket.status }}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge priority-{{ ticket.prioridade.lower() }}">
                                {{ ticket.prioridade }}
                            </span>
                        </td>
                        <td>{{ ticket.data_criacao.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('ticket.view', ticket_id=ticket.ticket_id) }}" class="btn btn-sm btn-secondary">
                                <i class="fas fa-eye"></i> Ver Detalhes
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if pagination.pages > 1 %}
    <nav class="pagination-nav">
        <!-- Botão 'Anterior' -->
        {% if pagination.has_prev %}
            <a href="{{ url_for('ticket.search', query=query, page=pagination.prev_num) }}" class="pagination-item">&laquo; Anterior</a>
        {% else %}
            <span class="pagination-item disabled">&laquo; Anterior</span>
        {% endif %}

        <!-- Números das Páginas -->
        {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
            {% if page_num %}
                {% if pagination.page == page_num %}
                    <span class="pagination-item active">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for('ticket.search', query=query, page=page_num) }}" class="pagination-item">{{ page_num }}</a>
                {% endif %}
            {% else %}
                <span class="pagination-item ellipsis">…</span>
            {% endif %}
        {% endfor %}

        <!-- Botão 'Próxima' -->
        {% if pagination.has_next %}
            <a href="{{ url_for('ticket.search', query=query, page=pagination.next_num) }}" class="pagination-item">Próxima &raquo;</a>
        {% else %}
            <span class="pagination-item disabled">Próxima &raquo;</span>
        {% endif %}
    </nav>
    {% endif %}

    <div style="text-align: center; margin-top: 30px;">
        <a href="{{ url_for('ticket.search') }}" class="btn btn-secondary">
            <i class="fas fa-search"></i> Nova Consulta
        </a>
    </div>
</div>
{% endblock %}
